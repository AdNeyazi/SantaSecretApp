<!DOCTYPE html>
<html>
<head>
  <title>Secret Santa App</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
    .container { max-width: 1200px; margin: 0 auto; }
    .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
    .section { background: white; padding: 20px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .btn { display: inline-block; padding: 10px 20px; margin: 5px; text-decoration: none; border-radius: 5px; font-weight: bold; }
    .btn-primary { background-color: #007bff; color: white; }
    .btn-success { background-color: #28a745; color: white; }
    .btn-info { background-color: #17a2b8; color: white; }
    .btn-warning { background-color: #ffc107; color: black; }
    .table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    .table th, .table td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
    .table th { background-color: #f8f9fa; font-weight: bold; }
    .flash { padding: 15px; margin: 10px 0; border-radius: 5px; }
    .flash-success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .flash-error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .flash-info { background-color: #e2e3e5; color: #383d41; border: 1px solid #d6d8db; }
    .stats { display: flex; gap: 20px; margin-bottom: 20px; }
    .stat-card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); flex: 1; text-align: center; }
    .stat-number { font-size: 2em; font-weight: bold; color: #667eea; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üéÖ Secret Santa App</h1>
      <p>Automate your company's Secret Santa gift exchange</p>
    </div>

    <% if flash[:success] %>
      <div class="flash flash-success"><%= flash[:success] %></div>
    <% end %>
    
    <% if flash[:error] %>
      <div class="flash flash-error"><%= flash[:error] %></div>
    <% end %>
    
    <% if flash[:info] %>
      <div class="flash flash-info"><%= flash[:info] %></div>
    <% end %>

    <div class="stats">
      <div class="stat-card">
        <div class="stat-number"><%= @employees.count %></div>
        <div>Total Employees</div>
      </div>
      <div class="stat-card">
        <div class="stat-number"><%= @current_assignments.count %></div>
        <div>Current Assignments</div>
      </div>
      <div class="stat-card">
        <div class="stat-number"><%= @previous_assignments.count %></div>
        <div>Previous Year</div>
      </div>
    </div>

    <div class="section">
      <h2>üöÄ Quick Actions</h2>
      <div>
        <%= link_to "Upload Employee CSV", secret_santa_upload_csv_path, class: "btn btn-primary" %>
        <%= link_to "Upload Previous Assignments", secret_santa_upload_csv_path, class: "btn btn-info" %>
        
        <%= form_tag secret_santa_create_assignments_path, method: :post, style: "display: inline;", data: { confirm: "This will create new Secret Santa assignments. Continue?" } do %>
          <%= submit_tag "Generate Assignments", class: "btn btn-success" %>
        <% end %>
        
        <%= link_to "Download Assignments", secret_santa_download_csv_path, class: "btn btn-warning" %>
      </div>
    </div>

    <div class="section">
      <h2>üë• Current Employees</h2>
      <% if @employees.any? %>
        <table class="table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Email</th>
            </tr>
          </thead>
          <tbody>
            <% @employees.each do |employee| %>
              <tr>
                <td>
                  <% if employee.slug.present? %>
                    <%= link_to employee.name, employee_path(employee.slug), class: "text-decoration-none" %>
                  <% else %>
                    <%= employee.name %>
                  <% end %>
                </td>
                <td><%= employee.email %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      <% else %>
        <p>No employees found. Please upload an employee CSV file.</p>
      <% end %>
    </div>

    <div class="section">
      <h2>üéÅ Current Year Assignments (<%= Date.current.year %>)</h2>
      <% if @current_assignments.any? %>
        <table class="table">
          <thead>
            <tr>
              <th>Employee</th>
              <th>Email</th>
              <th>Secret Child</th>
              <th>Secret Child Email</th>
            </tr>
          </thead>
          <tbody>
            <% @current_assignments.each do |assignment| %>
              <tr>
                <td>
                  <% if assignment.employee.slug.present? %>
                    <%= link_to assignment.employee.name, employee_path(assignment.employee.slug), class: "text-decoration-none" %>
                  <% else %>
                    <%= assignment.employee.name %>
                  <% end %>
                </td>
                <td><%= assignment.employee.email %></td>
                <td>
                  <% if assignment.secret_child.slug.present? %>
                    <%= link_to assignment.secret_child.name, employee_path(assignment.secret_child.slug), class: "text-decoration-none" %>
                  <% else %>
                    <%= assignment.secret_child.name %>
                  <% end %>
                </td>
                <td><%= assignment.secret_child.email %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      <% else %>
        <p>No assignments for the current year. Generate assignments to get started!</p>
      <% end %>
    </div>

    <% if @previous_assignments.any? %>
      <div class="section">
        <h2>üìÖ Previous Year Assignments (<%= Date.current.year - 1 %>)</h2>
        <table class="table">
          <thead>
            <tr>
              <th>Employee</th>
              <th>Email</th>
              <th>Secret Child</th>
              <th>Secret Child Email</th>
            </tr>
          </thead>
          <tbody>
            <% @previous_assignments.each do |assignment| %>
              <tr>
                <td>
                  <% if assignment.employee.slug.present? %>
                    <%= link_to assignment.employee.name, employee_path(assignment.employee.slug), class: "text-decoration-none" %>
                  <% else %>
                    <%= assignment.employee.name %>
                  <% end %>
                </td>
                <td><%= assignment.employee.email %></td>
                <td>
                  <% if assignment.secret_child.slug.present? %>
                    <%= link_to assignment.secret_child.name, employee_path(assignment.secret_child.slug), class: "text-decoration-none" %>
                  <% else %>
                    <%= assignment.secret_child.name %>
                  <% end %>
                </td>
                <td><%= assignment.secret_child.email %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    <% end %>
  </div>
</body>
</html>
